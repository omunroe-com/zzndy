<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <link rel="stylesheet" href="../style/pixelless.css" type="text/css"/>
	<script type="text/javascript" src="../script/canvas.js"></script>
	<script type="text/javascript" src="../script/geometry.js"></script>
    <title>Tri</title>
</head>
<body>
<div id="container">
    <div class="content header">
        <h1>Tri</h1>
    </div>

    <div class="content">
		<canvas id="can" width="800px" height="500px"></canvas>
        <div class="empty_footer">
        </div>
    </div>
</div>
<div id="footer">
    <div class="content">
        &copy; Vynogradov 2011
    </div>
</div>
<script type="text/javascript" language="JavaScript">
	var canvas = document.getElementById('can');
	var ctx = canvas.getContext('2d');
	ctx.strokeStyle = 'gold';
	ctx.translate(0.5, .5);
	var point = new Point(0,0);
	
	var height = 500, width = 800;
	
	var n = 10;
	var m = 30;
	var a = 20;
	var dx = Math.sqrt(3)*a/2;
	var dy = a/2;
	
	function frame(t)
	{
		ctx.clearRect(0,0,800,500);
		
		ctx.moveTo(0, point.y);
		ctx.lineTo(point.x, point.y);
		ctx.stroke(0);
	
		for(var i=0;i<n;++i)
		for(var j=0;j<m;++j)
		{
			var y = Math.floor((2*a*i+a*i)/2);
			var x = dx * j;
			var alpha=0;
			if((j+i)%2){
				y-=a/2;
				alpha=Math.PI;
			}
						
			ctx.save()
				.translate(x,y)
				.rotate(alpha)
				.beginPath(0, -a)
				.lineTo(dx, dy)
				.lineTo(-dx, dy)
				.lineTo(0, -a)
				.closePath()
				.stroke()
				.restore();
		}

		//window.mozRequestAnimationFrame(frame);
	}
	
	function mouseToCanvas(e)
    {
        var x = 0,y = 0;

        if (!e)
        {
            e = window.event;
            x = e.offsetX;
            y = e.offsetY;
        }
        else // we assume DOM modeled javascript
        {
            var elt = e.target ;
            var left = 0;
            var top = 0 ;

            while (elt.offsetParent)
            {
                left += elt.offsetLeft;
                top += elt.offsetTop;
                elt = elt.offsetParent;
            }

            x = e.pageX - left;
            y = e.pageY - top;
        }

        return new Point(x, y);
    }

	
	frame();
	canvas.addEventListener('mousemove', handle, true, false);
		
	function handle(e)
	{
		point = mouseToCanvas(e);
		window.mozRequestAnimationFrame(frame);
	}
	
</script>
</body>
</html>
